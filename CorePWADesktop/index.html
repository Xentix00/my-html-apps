<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CorePWA | Desktop Suite</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <style>
        :root {
            --bg-grad-1: #F2F2F7;
            --bg-grad-2: #E5E5EA;
            --card: rgba(255, 255, 255, 0.7);
            --text: #1D1D1F;
            --subtext: #86868B;
            --accent: #007AFF;
            --accent-glow: rgba(0, 122, 255, 0.15);
            --input-border: rgba(0, 0, 0, 0.1);
            --input-bg: #FFFFFF;
            --splash-bg: #FFFFFF;
        }

        [data-theme="dark"] {
            --bg-grad-1: #000000;
            --bg-grad-2: #1C1C1E;
            --card: rgba(28, 28, 30, 0.7);
            --text: #F5F5F7;
            --subtext: #86868B;
            --accent: #0A84FF;
            --accent-glow: rgba(10, 132, 255, 0.2);
            --input-border: rgba(255, 255, 255, 0.1);
            --input-bg: #2C2C2E;
            --splash-bg: #000000;
        }

        * {
            box-sizing: border-box;
            transition: all 0.4s cubic-bezier(0.25, 0.1, 0.25, 1);
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Helvetica Neue", sans-serif;
            background: linear-gradient(135deg, var(--bg-grad-1), var(--bg-grad-2), var(--bg-grad-1));
            background-size: 400% 400%;
            animation: ambientMove 20s ease infinite;
            color: var(--text);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            overflow: hidden;
        }

        @keyframes ambientMove {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        /* Splash Screen */
        #splash {
            position: fixed;
            inset: 0;
            background: var(--splash-bg);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        #splash.hidden { opacity: 0; visibility: hidden; }
        .splash-logo { width: 150px; animation: splashPop 1.4s cubic-bezier(0.16, 1, 0.3, 1); }
        @keyframes splashPop { from { transform: scale(0.85); opacity: 0; } to { transform: scale(1); opacity: 1; }}

        /* Main Workspace */
        .app-window {
            width: 90vw;
            max-width: 1200px;
            height: 85vh;
            display: flex;
            flex-direction: column;
            background: var(--card);
            backdrop-filter: blur(40px);
            -webkit-backdrop-filter: blur(40px);
            border-radius: 24px;
            border: 1px solid var(--input-border);
            box-shadow: 0 30px 60px rgba(0,0,0,0.12);
            opacity: 0;
            transform: translateY(30px);
        }
        .app-window.visible { opacity: 1; transform: translateY(0); }

        /* Window Header */
        header {
            padding: 20px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--input-border);
        }
        .brand { display: flex; align-items: center; gap: 15px; }
        .brand img { width: 40px; }
        .brand h1 { font-size: 20px; font-weight: 700; margin: 0; letter-spacing: -0.5px; }

        /* Split View Body */
        .workspace {
            display: flex;
            flex: 1;
            overflow: hidden;
        }

        /* Sidebar Pane */
        .sidebar {
            width: 350px;
            padding: 30px;
            border-right: 1px solid var(--input-border);
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 25px;
        }

        /* Editor Pane */
        .editor-pane {
            flex: 1;
            padding: 30px;
            display: flex;
            flex-direction: column;
            background: rgba(0,0,0,0.02);
        }

        .label {
            font-size: 11px;
            font-weight: 700;
            color: var(--subtext);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 10px;
            display: block;
        }

        /* Form Styling */
        input[type="text"], textarea {
            width: 100%;
            background: var(--input-bg);
            border: 1px solid var(--input-border);
            border-radius: 12px;
            padding: 14px;
            color: var(--text);
            font-size: 15px;
            outline: none;
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.02);
        }
        input[type="text"]:focus, textarea:focus {
            border-color: var(--accent);
            box-shadow: 0 0 0 4px var(--accent-glow);
        }

        textarea {
            flex: 1;
            font-family: "SF Mono", "Fira Code", monospace;
            font-size: 13px;
            line-height: 1.6;
            margin-bottom: 20px;
        }

        /* Dynamic Asset Drop Zone */
        .drop-zone {
            background: var(--input-bg);
            border: 2px dashed var(--input-border);
            border-radius: 16px;
            padding: 40px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .drop-zone:hover, .drop-zone.drag-over {
            border-color: var(--accent);
            background: var(--accent-glow);
        }
        .drop-zone span { color: var(--accent); font-weight: 600; display: block; }
        .drop-zone p { font-size: 12px; color: var(--subtext); margin: 8px 0 0; }

        #previewIcon {
            width: 100px; height: 100px;
            border-radius: 22px;
            margin: 20px auto 0;
            display: none;
            object-fit: cover;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            animation: popIn 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        @keyframes popIn { from { transform: scale(0.5); opacity: 0; } to { transform: scale(1); opacity: 1; }}

        /* Action Footer */
        .footer-actions {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .primary-btn {
            background: var(--accent);
            color: white;
            border: none;
            border-radius: 14px;
            padding: 16px 32px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            box-shadow: 0 10px 20px var(--accent-glow);
        }
        .primary-btn:hover { transform: translateY(-2px); filter: brightness(1.1); }
        .primary-btn:active { transform: scale(0.97); }

        .theme-btn {
            background: transparent;
            border: 1px solid var(--input-border);
            color: var(--text);
            padding: 10px 18px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
        }

        .hidden-file { display: none; }
    </style>
</head>
<body data-theme="light">

    <div id="splash">
        <img id="splashLogo" src="Logos/CorePWALogoLIGHT.png" class="splash-logo" alt="CorePWA Logo">
    </div>

    <div class="app-window" id="appWindow">
        <header>
            <div class="brand">
                <img id="headerLogo" src="Logos/CorePWALogoLIGHT.png" alt="Logo">
                <h1>CorePWA <span style="font-weight: 300; opacity: 0.5;">Desktop</span></h1>
            </div>
            <button class="theme-btn" onclick="toggleTheme()">SWITCH THEME</button>
        </header>

        <div class="workspace">
            <aside class="sidebar">
                <div class="section">
                    <span class="label">Project Identity</span>
                    <div style="display: flex; flex-direction: column; gap: 15px;">
                        <input type="text" id="appName" placeholder="Full Application Name" autocomplete="off">
                        <input type="text" id="shortName" placeholder="Home Screen Label" autocomplete="off">
                    </div>
                </div>

                <div class="section">
                    <span class="label">Brand Assets</span>
                    <div class="drop-zone" id="dropZone" onclick="document.getElementById('iconInput').click()">
                        <span>Drop Icon Here</span>
                        <p>192x192 recommended. <br>Center-crop applied.</p>
                        <input type="file" id="iconInput" class="hidden-file" accept="image/*" onchange="processImage(event)">
                        <img id="previewIcon">
                    </div>
                </div>

                <div style="margin-top: auto;">
                    <button class="primary-btn" onclick="generatePWA()" style="width: 100%;">Export Project Bundle</button>
                </div>
            </aside>

            <main class="editor-pane">
                <span class="label">HTML Source Code</span>
                <textarea id="htmlInput" placeholder="" spellcheck="false"></textarea>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <p style="font-size: 11px; color: var(--subtext);">Ready for deployment on GitHub Pages or any HTTPS host.</p>
                    <p style="font-size: 11px; color: var(--subtext); opacity: 0.5;">CorePWA Suite v1.0</p>
                </div>
            </main>
        </div>
    </div>

<script>
    let iconBlob = null;

    // --- Theme Controller ---
    function setTheme(theme) {
        document.body.setAttribute('data-theme', theme);
        const logoPath = theme === 'light' ? 'Logos/CorePWALogoLIGHT.png' : 'Logos/CorePWALogoDARK.png';
        document.getElementById('splashLogo').src = logoPath;
        document.getElementById('headerLogo').src = logoPath;
    }

    function toggleTheme() {
        const current = document.body.getAttribute('data-theme');
        setTheme(current === 'light' ? 'dark' : 'light');
    }

    // Auto System Detection
    if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) setTheme('dark');

    // --- Entrance Animation ---
    window.addEventListener('load', () => {
        setTimeout(() => {
            document.getElementById('splash').classList.add('hidden');
            document.getElementById('appWindow').classList.add('visible');
        }, 1600);
    });

    // --- Image Processing & Drag/Drop ---
    const dropZone = document.getElementById('dropZone');
    ;['dragenter', 'dragover', 'dragleave', 'drop'].forEach(n => dropZone.addEventListener(n, e => { e.preventDefault(); e.stopPropagation(); }));
    ['dragenter', 'dragover'].forEach(n => dropZone.addEventListener(n, () => dropZone.classList.add('drag-over')));
    ['dragleave', 'drop'].forEach(n => dropZone.addEventListener(n, () => dropZone.classList.remove('drag-over')));

    dropZone.addEventListener('drop', e => {
        const file = e.dataTransfer.files[0];
        if (file && file.type.startsWith('image/')) processFile(file);
    });

    function processImage(e) { if (e.target.files[0]) processFile(e.target.files[0]); }

    function processFile(file) {
        const reader = new FileReader();
        reader.onload = (e) => {
            const img = new Image();
            img.onload = () => {
                const canvas = document.createElement('canvas');
                canvas.width = 192; canvas.height = 192;
                const ctx = canvas.getContext('2d');
                let size = Math.min(img.width, img.height);
                ctx.imageSmoothingQuality = 'high';
                ctx.drawImage(img, (img.width-size)/2, (img.height-size)/2, size, size, 0, 0, 192, 192);
                document.getElementById('previewIcon').src = canvas.toDataURL('image/png');
                document.getElementById('previewIcon').style.display = 'block';
                canvas.toBlob(b => { iconBlob = b; }, 'image/png');
            };
            img.src = e.target.result;
        };
        reader.readAsDataURL(file);
    }

    // --- Export Logic ---
    async function generatePWA() {
        const html = document.getElementById('htmlInput').value;
        const name = document.getElementById('appName').value || "CorePWA Project";
        const short = document.getElementById('shortName').value || "App";

        if (!html.includes('<head>') || !iconBlob) {
            alert("Configuration incomplete. Please provide HTML source and an app icon.");
            return;
        }

        const zip = new JSZip();
        const manifest = {
            "name": name, "short_name": short, "start_url": "index.html",
            "display": "standalone", "background_color": "#FFFFFF", "theme_color": "#FFFFFF",
            "icons": [{ "src": "icon.png", "sizes": "192x192", "type": "image/png" }]
        };

        const sw = `self.addEventListener('install', e => self.skipWaiting());\nself.addEventListener('fetch', e => e.respondWith(fetch(e.request)));`;
        const tags = `\n    \n    <link rel="manifest" href="manifest.json">\n    <meta name="apple-mobile-web-app-capable" content="yes">\n    <meta name="apple-mobile-web-app-status-bar-style" content="default">\n    <meta name="apple-mobile-web-app-title" content="${short}">\n    <link rel="apple-touch-icon" href="icon.png">\n    <script>if('serviceWorker' in navigator){navigator.serviceWorker.register('sw.js');}<\/script>`;

        zip.file("index.html", html.replace('</head>', tags + '\n</head>'));
        zip.file("manifest.json", JSON.stringify(manifest, null, 2));
        zip.file("sw.js", sw);
        zip.file("icon.png", iconBlob);

        const content = await zip.generateAsync({type:"blob"});
        const link = document.createElement('a');
        link.href = URL.createObjectURL(content);
        link.download = "corepwa-desktop-build.zip";
        link.click();
    }
</script>
</body>
</html>